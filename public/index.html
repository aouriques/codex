<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Auto Scroll Recorder</title>
    <style>
        :root { --bg:#0b0f14; --card:#111827; --muted:#9ca3af; --text:#e5e7eb; --accent:#60a5fa; }
        body { margin:0; background:var(--bg); color:var(--text); font:14px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,sans-serif; }
        .wrap { max-width: 760px; margin: 32px auto; padding: 0 16px; }
        h1 { font-size: 22px; margin: 0 0 16px; }
        .card { background: var(--card); border-radius: 14px; padding: 18px; box-shadow: 0 10px 30px rgba(0,0,0,.35); }
        label { display:block; margin:10px 0 6px; color:#cbd5e1; }
        textarea, input { width:100%; box-sizing:border-box; background:#0f172a; color:var(--text); border:1px solid #223047; border-radius:10px; padding:10px 12px; }
        button { background: var(--accent); color:#081425; border:0; padding:12px 16px; border-radius:12px; font-weight:600; cursor:pointer; margin-top:14px; width:100%; }
        button:disabled { opacity:.6; cursor:not-allowed; }
        .muted { color: var(--muted); font-size:12px; margin-top:8px; }
        .status { margin-top:16px; white-space:pre-wrap; background:#0b1220; border:1px solid #1f2a44; border-radius:12px; padding:12px; min-height:140px; }
        a { color:#93c5fd; text-decoration:none; }
        a:hover { text-decoration:underline; }
    </style>
</head>
<body>
<div class="wrap">
    <h1>Auto Scroll Recorder</h1>
    <div class="card">
        <label>Article URLs (one per line)</label>
        <textarea id="urls" rows="8" placeholder="https://example.com/article-1&#10;https://example.com/article-2"></textarea>

        <label>Scroll Speed (pixels per second)</label>
        <input id="scrollSpeed" type="number" value="60" min="10" step="10" />
        <div class="muted">Tip: 60 = slow, 200–400 = medium, 600+ = fast.</div>

        <button id="startBtn">Record</button>

        <label>Status</label>
        <div id="status" class="status">Idle.</div>
    </div>
</div>

<script>
    const $ = (id) => document.getElementById(id);
    const statusBox = $("status");
    const startBtn  = $("startBtn");

    function setStatus(text) { statusBox.textContent = text; }
    function appendStatus(line) { statusBox.textContent += (statusBox.textContent ? "\n" : "") + line; }

    async function poll(jobId) {
        const tick = async () => {
            const res = await fetch(`/api/status/${jobId}`);
            if (!res.ok) { appendStatus("Status error."); return; }
            const data = await res.json();
            let lines = [`Status: ${data.status}`];
            if (data.startedAt) lines.push(`Started: ${data.startedAt}`);
            if (data.finishedAt) lines.push(`Finished: ${data.finishedAt}`);
            if (data.logs?.length) lines.push("", data.logs.join("\n"));
            if (data.results?.length) {
                lines.push("", "Results:");
                for (const r of data.results) {
                    lines.push(`• ${r.url}`);
                    lines.push(`  → ${r.file}`);
                }
            }
            setStatus(lines.join("\n"));
            if (data.status === "running" || data.status === "queued") {
                setTimeout(tick, 1500);
            } else {
                startBtn.disabled = false;
            }
        };
        tick();
    }

    startBtn.addEventListener("click", async () => {
        startBtn.disabled = true;
        setStatus("Submitting job...");
        const body = {
            urls: $("urls").value,
            scrollSpeed: Number($("scrollSpeed").value)
        };
        try {
            const res = await fetch("/api/record", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(body)
            });
            const data = await res.json();
            if (!res.ok) throw new Error(data.error || "Failed to start job.");
            setStatus(`Job started: ${data.jobId}\nPolling...`);
            poll(data.jobId);
        } catch (e) {
            setStatus("Error: " + e.message);
            startBtn.disabled = false;
        }
    });
</script>
</body>
</html>
